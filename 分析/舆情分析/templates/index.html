{% extends 'base.html' %}

{% block title %}舆情控制系统 - 主页{% endblock %}

{% block content %}
    <div style="padding: 20px;">
        <div class="layui-card">
            <div class="layui-card-header">系统介绍</div>
            <div class="layui-card-body">
                <p>舆情控制系统是一个用于监控、分析和管理网络舆情的系统，帮助用户及时了解和应对网络上的相关信息。</p>
                <p>系统功能包括：舆情信息采集、情感分析、关键词提取、趋势分析等。</p>
            </div>
        </div>
        
        <!-- 统计信息 -->
        <div class="layui-row layui-col-space15" style="margin-top: 20px;">
            <div class="layui-col-md4">
                <div class="layui-card">
                    <div class="layui-card-header">今日舆情</div>
                    <div class="layui-card-body">
                        <div class="layui-carousel layadmin-carousel layadmin-backlog" lay-anim="layui-anim-upbit" lay-indicator="inside">
                            <div class="layui-carousel-main">
                                <div carousel-item id="today-topics">
                                    <!-- 通过AJAX加载今日舆情数量 -->
                                    <div class="item layadmin-backlog-body">
                                        <h3 id="today-topics-count">128</h3>
                                        <p>今日新增舆情</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="layui-col-md4">
                <div class="layui-card">
                    <div class="layui-card-header">情感分布</div>
                    <div class="layui-card-body">
                        <div class="layui-progress layui-progress-big" lay-showpercent="yes">
                            <div class="layui-progress-bar layui-bg-green" lay-percent="45%" id="sentiment-positive"></div>
                        </div>
                        <div class="layui-progress layui-progress-big" lay-showpercent="yes">
                            <div class="layui-progress-bar layui-bg-orange" lay-percent="30%" id="sentiment-neutral"></div>
                        </div>
                        <div class="layui-progress layui-progress-big" lay-showpercent="yes">
                            <div class="layui-progress-bar layui-bg-red" lay-percent="25%" id="sentiment-negative"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="layui-col-md4">
                <div class="layui-card">
                    <div class="layui-card-header">热门关键词</div>
                    <div class="layui-card-body">
                        <div class="layui-elem-quote layui-quote-nm" id="hot-keywords">
                            <!-- 通过AJAX加载热门关键词 -->
                            <a href="#" class="layui-btn layui-btn-primary layui-btn-xs">疫情</a>
                            <a href="#" class="layui-btn layui-btn-primary layui-btn-xs">经济</a>
                            <a href="#" class="layui-btn layui-btn-primary layui-btn-xs">政策</a>
                            <a href="#" class="layui-btn layui-btn-primary layui-btn-xs">科技</a>
                            <a href="#" class="layui-btn layui-btn-primary layui-btn-xs">教育</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script>
    layui.use(['element', 'carousel', 'progress', 'jquery'], function(){
        var element = layui.element;
        var carousel = layui.carousel;
        var progress = layui.progress;
        var $ = layui.jquery;
        
        // 初始化轮播
        carousel.render({
            elem: '#today-topics'
            ,width: '100%'
            ,height: '120px'
            ,interval: 5000
        });
        
        // 加载今日舆情数量
        $.ajax({
            url: '/api/statistics/today-topics',
            type: 'GET',
            success: function(res){
                if(res.code === 0){
                    $('#today-topics-count').text(res.data);
                }
            }
        });
        
        // 加载情感分布
        $.ajax({
            url: '/api/statistics/sentiment-distribution',
            type: 'GET',
            success: function(res){
                if(res.code === 0){
                    var data = res.data;
                    $('#sentiment-positive').attr('lay-percent', data.positive + '%');
                    $('#sentiment-neutral').attr('lay-percent', data.neutral + '%');
                    $('#sentiment-negative').attr('lay-percent', data.negative + '%');
                    element.render('progress');
                }
            }
        });
        
        // 加载热门关键词
        $.ajax({
            url: '/api/statistics/hot-keywords',
            type: 'GET',
            success: function(res){
                if(res.code === 0){
                    var keywords = res.data;
                    var html = '';
                    for(var i = 0; i < keywords.length; i++){
                        html += '<a href="#" class="layui-btn layui-btn-primary layui-btn-xs">' + keywords[i].word + '</a> ';
                    }
                    $('#hot-keywords').html(html);
                }
            }
        });
    });
</script>
{% endblock %}
